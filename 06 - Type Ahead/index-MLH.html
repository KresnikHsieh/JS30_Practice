<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

const cities = [];

// Step.1 Fetch Data
fetch(endpoint)
	.then(blob => blob.json()) //å–å¾—readableStreamä¸¦è½‰æˆjsonå¾Œreturn
	.then(data => cities.push(...data))//å°‡dataä»£å…¥citiesçš„é™£åˆ—ä¸­

// Step.2 æ‰¾åˆ°å°æ‡‰ä½¿ç”¨è€…è¼¸å…¥å…§å®¹çš„é™£åˆ—
function findMatches(wordToMatch, cities){
	//Array.prototype.filter()å¯ä»¥æ ¹æ“šè¼¸å…¥çš„å…§å®¹(wordToMatch)åœ¨citiesä¸­éæ¿¾ç¯©é¸è³‡æ–™
	return cities.filter(place => {
		//è¦æ‰¾å‡ºèˆ‡æ‰€æœå°‹çš„é—œéµå­—matchçš„city
		const regex = new RegExp(wordToMatch,'gi');//å»ºç«‹æ­£è¦å¼
		//åœ¨new RegExp(regex,flag)ä¸­ï¼Œregexç‚ºæ­£è¦å¼çš„å…§å®¹
		//flag -- gè¡¨ç¤ºglobal searchï¼Œå°‹æ‰¾æ•´ä»½æ–‡ä»¶ï¼Œè€Œéæ‰¾åˆ°å°±åœæ­¢ //-- iè¡¨ç¤ºcase insensitiveï¼Œä¸å€åˆ†å¤§å°å¯«
		return place.city.match(regex) || place.state.match(regex);
		//ä½¿ç”¨String.prototype.match(regex)åˆ¤æ–·æ˜¯å¦æœ‰ç¬¦åˆregexçš„å…§å®¹ï¼Œæœ‰å‰‡å›å‚³é™£åˆ—ï¼Œç„¡å‰‡å›å‚³null
	});
}

function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");} //snippet: æ•¸å­—åŠ ä¸Šé€—è™Ÿ

// Step.3 ç›£è½ä½¿ç”¨è€…è¼¸å…¥çš„å…§å®¹ï¼Œå›å‚³çµæœ
function displayMatches(e){
	// console.log(this.value);
	const matchArray = findMatches(this.value, cities);//Step.3-1 å–å¾—é…å°çš„å…§å®¹
	// console.log(matchArray);
	const html = matchArray.map(place => { //Step.3-2 å°‡é…å°åˆ°çš„å…§å®¹æ”¹æˆHTMLæ ¼å¼
		const regex = new RegExp(this.value, 'gi');
		const cityName = place.city.replace(regex, `<span class="h1">${this.value}</span>`);
		const stateName = place.state.replace(regex, `<span class="h1">${this.value}</span>`);
		//ä½¿ç”¨String.prototype.replace(regex|substr, newSubstr)ç½®æ›å…§å®¹ï¼Œæ­¤æ–¹æ³•å›å‚³ç½®æ›å¾Œçš„æ–°å­—ä¸²ï¼Œä¸æ”¹è®ŠåŸæœ¬å­—ä¸²

		return 
		`<li>
		 	<span class ="name">${cityName}, ${stateName}</span>
		 	<span class ="population">${numberWithCommas(place.population)}</span>
		 </li>`;
	}).join('');
	suggestions.innerHTML = html; //Step.3-3 å°‡å…§å®¹å­˜å…¥DOMä¸­
}

const searchInput = document.querySelector('.search');
const suggestions = document.querySelector('.suggestions');


searchInput.addEventListener('change',displayMatches);
searchInput.addEventListener('keyup',displayMatches); 

</script>
</body>
</html>
